syntax = "proto3";

package oj.judger;

import "google/protobuf/empty.proto";

message JudgeRequest {
  uint32 lang_id = 1;
  bytes code = 2;
  // memory limit in byte
  uint64 memory = 3;
  // time limit in nanosecond
  int32 time = 4;
  // len must > 0
  repeated TestCase tests = 5;
}

message TestCase {
  bytes input = 1;
  bytes output = 2;
}

message JudgeResponse {
  oneof state {
    // number of test case running(or finished)
    int32 case = 1;
    JudgeResult result = 2;
  }
}

message JudgeResult {
  JudgeResultState state = 1;
  // the longest time the code need to run the input
  float max_time = 2;
  bytes stderr = 3;
}

enum JudgeResultState {
  AC = 0;
  NA = 1;
  WA = 2;
  CE = 3;
  RE = 4;
  RF = 5;
  TLE = 6;
  MLE = 7;
  OLE = 8;
}

message Langs { repeated LangInfo list = 1; }

message LangInfo {
  uint32 lang_id = 1;
  string lang_name = 2;
  // compiler info or runtime info
  string info = 3;
  string lang_ext = 4;
}

message JudgeInfo {
  // memory limit of judger in byte
  uint64 memory = 1;
  // max possible deviation in nanosecond
  int64 accuracy = 2;
  Langs langs = 3;
  float cpu_factor = 4;
}

service Judger {
  // judge code
  rpc Judge(JudgeRequest) returns (stream JudgeResponse);

  rpc JudgerInfo(google.protobuf.Empty) returns (JudgeInfo);
}